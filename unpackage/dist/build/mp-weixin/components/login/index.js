(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/login/index"],{1722:function(e,n,t){"use strict";var o=t("3f73"),r=t.n(o);r.a},"374a":function(e,n,t){"use strict";(function(e){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=a(t("a34a")),r=t("26cb");function a(e){return e&&e.__esModule?e:{default:e}}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){u(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function u(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function c(e,n,t,o,r,a,i){try{var s=e[a](i),u=s.value}catch(c){return void t(c)}s.done?n(u):Promise.resolve(u).then(o,r)}function l(e){return function(){var n=this,t=arguments;return new Promise((function(o,r){var a=e.apply(n,t);function i(e){c(a,o,r,i,s,"next",e)}function s(e){c(a,o,r,i,s,"throw",e)}i(void 0)}))}}var f={data:function(){var e=this;return{show:!0,getUserInfoTag:!0,loginType:"pwlogin",subsectionList:[{name:"密码登录"},{name:"验证码登录"},{name:"手机注册"},{name:"邮箱注册"}],form:{login:"",avatar:"",name:"贺鹏程",phone:"",email:"",code:"",password:"8888",repassword:""},rules:{login:[{validator:function(n,t,o){return"pwlogin"!==e.loginType||!e.$u.test.isEmpty(t)},message:"必填 * 输入内容不许为空",trigger:["change","blur"]}],name:[{validator:function(n,t,o){return"phone"!==e.loginType&&"email"!==e.loginType||e.$u.test.rangeLength(t,[2,10])},message:"必填 * 昵称长度不得小于2位大于10位",trigger:["change","blur"]}],phone:[{validator:function(n,t,o){return"codelogin"!==e.loginType&&"phone"!==e.loginType||e.$u.test.mobile(t)},message:"必填 * 手机号码输入不正确",trigger:["change","blur"]}],email:[{asyncValidator:function(){var n=l(o.default.mark((function n(t,r,a){var i;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if("email"!==e.loginType){n.next=8;break}return n.next=3,e.$u.api.findUser({name:r});case 3:i=n.sent,i&&(i.statusCode=200),r&&200===i.statusCode?(console.log(1),a(new Error("当前邮箱已注册"))):(console.log(2),a()),n.next=9;break;case 8:a();case 9:case"end":return n.stop()}}),n)})));function t(e,t,o){return n.apply(this,arguments)}return t}(),trigger:["blur"]},{validator:function(n,t,o){return"email"!==e.loginType||e.$u.test.email(t)},message:"必填 * 邮箱地址输入不正确",trigger:["change","blur"]}],code:[{validator:function(n,t,o){return"pwlogin"===e.loginType||"8888"===t},message:"必填 * 验证码长度为4位",trigger:["change","blur"]}],password:[{validator:function(n,t,o){return"codelogin"===e.loginType||t.length>=4&&t.length<=20},message:"必填  * 请输入 4-20 位密码",trigger:["change","blur"]}],repassword:[{validator:function(n,t,o){return("phone"===e.loginType||"email"===e.loginType)&&e.form.password===t},message:"必填 * 两次密码输入不一致",trigger:["change","blur"]}]}}},onReady:function(){this.$refs.uForm.setRules(this.rules)},created:function(){var n=this;wx.getSetting({success:function(t){t.authSetting["scope.userInfo"]&&e.getUserInfo({success:function(e){n.getUserInfoTag=!1,n.form.login="贺鹏程",n.form.name="贺鹏程",n.form.avatar=e.userInfo.avatarUrl},fail:function(){console.log("用户未授权")}})}})},methods:s(s({},(0,r.mapActions)(["userLoginAction"])),{},{getCode:function(){var n=this;return l(o.default.mark((function t(){return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if("codeLogin"!==n.loginType){t.next=6;break}return t.next=3,n.$u.api.getLoginCode({phone:n.form.phone});case 3:t.sent,t.next=15;break;case 6:if("email"!==n.loginType){t.next=12;break}return t.next=9,n.$u.api.getRegisterCode({email:n.form.email});case 9:t.sent,t.next=15;break;case 12:return t.next=14,n.$u.api.getRegisterCode({phone:n.form.phone});case 14:t.sent;case 15:pcode.data.message&&"获取成功"===pcode.data.message[0]?e.showModal({title:"验证码获取成功",content:"8888"}):e.showModal({title:"验证码获取失败",content:pcode.data.errors.phone[0]});case 16:case"end":return t.stop()}}),t)})))()},submit:function(){var n=this;this.$refs.uForm.validate(function(){var t=l(o.default.mark((function t(r){var a,i,s,u,c,l;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r){t.next=3;break}return e.showToast({title:"请检查输入",icon:"loading"}),t.abrupt("return",!1);case 3:t.t0=n.loginType,t.next="pwlogin"===t.t0?6:"codelogin"===t.t0?12:"phone"===t.t0?17:"email"===t.t0?22:28;break;case 6:return t.next=8,n.$u.api.userLogin({login:n.form.login,password:n.form.password});case 8:return a=t.sent,a&&(a.statusCode=200),200===a.statusCode?n.loginAfter(a.access_token):e.showModal({title:"登陆失败",content:null===(i=a.data)||void 0===i?void 0:i.message}),t.abrupt("break",30);case 12:return t.next=14,n.$u.api.userLogin({login:n.form.phone,verifiable_code:"8888"});case 14:return s=t.sent,200===s.statusCode?n.loginAfter(s.data.access_token):e.showModal({title:"登陆失败",content:s.data.message}),t.abrupt("break",30);case 17:return t.next=19,n.$u.api.userRegister({name:n.form.name,verifiable_type:"sms",verifiable_code:"8888",phone:n.form.phone,password:n.form.password});case 19:return u=t.sent,201===u.statusCode?(console.log(u),n.loginAfter(u.data.token)):e.showModal({title:"登陆失败",content:null===(c=u.data)||void 0===c?void 0:c.message}),t.abrupt("break",30);case 22:return t.next=24,n.$u.api.userRegister({name:n.form.name,verifiable_type:"mail",verifiable_code:"8888",email:n.form.email,password:n.form.password});case 24:return l=t.sent,console.log(l),201===l.statusCode||e.showModal({title:"登陆失败",content:l.data.message}),t.abrupt("break",30);case 28:return e.showToast({title:"未知用户状态",icon:"loading"}),t.abrupt("break",30);case 30:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},cancel:function(){this.form={login:"",avatar:"",name:"",phone:"",email:"",code:"",password:"",repassword:""}},closeLogin:function(){this.show=!1},openLogin:function(){this.show=!0},gotoWeb:function(n){e.navigateTo({url:"/pages/webview/webview?url="+encodeURI(n)})},getWechatUserInfo:function(){var n=this;e.getUserInfo({success:function(e){n.getUserInfoTag=!1},fail:function(){console.log("用户未授权")}})},sectionChange:function(e){switch(e){case 1:this.loginType="codelogin";break;case 2:this.loginType="phone";break;case 3:this.loginType="email";break;default:this.loginType="pwlogin";break}},loginAfter:function(n){var t=this;return l(o.default.mark((function r(){var a;return o.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return e.setStorageSync("token",n),o.next=3,t.$u.api.getUserMsg();case 3:a=o.sent,t.userLoginAction({name:t.form.name,avatar:t.form.avatar,liked:a.user.liked,commented:a.user.commented}),e.$emit("indexLogin"),e.$emit("mineLogin");case 7:case"end":return o.stop()}}),r)})))()}})};n.default=f}).call(this,t("543d")["default"])},"3c62":function(e,n,t){"use strict";t.r(n);var o=t("e3a9"),r=t("924c");for(var a in r)"default"!==a&&function(e){t.d(n,e,(function(){return r[e]}))}(a);t("1722");var i,s=t("f0c5"),u=Object(s["a"])(r["default"],o["b"],o["c"],!1,null,"2a5f14ec",null,!1,o["a"],i);n["default"]=u.exports},"3f73":function(e,n,t){},"924c":function(e,n,t){"use strict";t.r(n);var o=t("374a"),r=t.n(o);for(var a in o)"default"!==a&&function(e){t.d(n,e,(function(){return o[e]}))}(a);n["default"]=r.a},e3a9:function(e,n,t){"use strict";t.d(n,"b",(function(){return r})),t.d(n,"c",(function(){return a})),t.d(n,"a",(function(){return o}));var o={uForm:function(){return t.e("node-modules/uview-ui/components/u-form/u-form").then(t.bind(null,"66c1"))},uFormItem:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-form-item/u-form-item")]).then(t.bind(null,"8943"))},uInput:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-input/u-input")]).then(t.bind(null,"e469"))},uButton:function(){return t.e("node-modules/uview-ui/components/u-button/u-button").then(t.bind(null,"6edb"))},uSubsection:function(){return t.e("node-modules/uview-ui/components/u-subsection/u-subsection").then(t.bind(null,"da23"))}},r=function(){var e=this,n=e.$createElement;e._self._c},a=[]}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/login/index-create-component',
    {
        'components/login/index-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("3c62"))
        })
    },
    [['components/login/index-create-component']]
]);
